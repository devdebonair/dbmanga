<style type="text/css">
    #filter {
        text-align: center;
        color: #9e9e9e;
    }
    
    #filter h1, h2, h3, h4, h5 {
        color: #ef5350;
    }
    
    #filter li {
        cursor: pointer;
    }
</style>

<div id="filter" class="row">
    <div class="col l2 hide-on-med-and-down">
        <div style="overflow-y: hidden">
            <h4>GENRES</h4>
            <ul id="filter-genres">
                <li value="adventure">Adventure</li>
                <li value="ecchi">Ecchi</li>
                <li value="harem">Harem</li>
                <li value="mature">Mature</li>
                <li value="romance">Romance</li>
                <li value="seinen">Seinen</li>
                <li value="shoujo">Shoujo</li>
                <li value="shounen">Shounen</li>
                <li value="slice of life">Slice of Life</li>
            </ul>
        </div>
        
        <div>
            <h4>STATUS</h4>
            <ul id="filter-status">
                <li value="complete">Complete</li>
                <li value="ongoing">Ongoing</li>
            </ul>
        </div>
        
        <div>
            <h5>CHAPTERS</h5>
            <ul id="filter-chapters">
                <li value="0 15">0 - 15</li>
                <li value="15 30">15 - 30</li>
                <li value="30 60">30 - 60</li>
                <li value="60 120">60 - 120</li>
                <li value="120 240">120 - 240</li>
                <li value="240 up">240 - Up</li>
            </ul>
        </div>
    </div>
    <div class="col s12 m12 l10">
        <section class="hide-on-large-only">
            <h5>What genre would you like to read?</h5>
            <div class="row">
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/attack-on-titan.jpg"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Shounen</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Shounen <i class="mdi-navigation-close right"></i></span>
                            <p>Shounen manga is typically characterized by high-action, often humorous plots featuring male protagonists. The camaraderie between boys or men on sports teams, fighting squads and the like is often emphasized. Attractive female characters like Bulma from Dragon Ball or Nami from One Piece, with exaggerated features are also common. Main characters may also feature an ongoing desire to better themselves.</p>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/dragon-ball.jpg"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Adventure</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Adventure <i class="mdi-navigation-close right"></i></span>
                            <p>Adventure manga is a genre of manga in which a main protagonist journeys on an adventure, an exciting undertaking involving risk and physical danger. This theme forms the basis of the main storyline. Stories are mainly character driven and may have no ulterior motive.</p>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/nagi-no-asukara.png"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Slice of Life</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Shounen <i class="mdi-navigation-close right"></i></span>
                            <p>A slice of life story is a category for a story that portrays a "cut-out" sequence of events in a character's life. It usually tries to depict the everyday life of ordinary people, sometimes but rarely, with fantasy or science fiction elements involved.</p>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/the-world-god-only-knows.jpg"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Harem</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Harem <i class="mdi-navigation-close right"></i></span>
                            <p>Harem is an ambiguously-defined subgenre of anime and manga characterized by a protagonist surrounded, usually amorously, by three or more members of the opposing sex and/or love interests.</p>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/nisekoi.jpg"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Romance</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Romance <i class="mdi-navigation-close right"></i></span>
                            <p>Romance manga place their primary focus on the relationship and romantic love between two people, and usually have an "emotionally satisfying and optimistic ending."</p>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/the-flower-we-saw.jpg"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Shoujo</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Shoujo <i class="mdi-navigation-close right"></i></span>
                            <p>Shoujo manga is manga marketed to a female audience roughly between the ages of 10 and 18. Shoujo manga covers many subjects in a variety of narrative and graphic styles, from historical drama to science fiction â€” often with a strong focus on human and romantic relationships and emotions.</p>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/black-lagoon.jpg"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Sienen</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Sienen <i class="mdi-navigation-close right"></i></span>
                            <p>Seinen manga is manga marketed to a male audience aged roughly 17 on into their 40's. In Japanese, the word seinen means "young man" or "young men." Seinen manga are distinguished from 'hentai', although there is sexual content of a softcore nature in some seinen series.</p>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/esdeath-ecchi.jpg"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Ecchi</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Ecchi <i class="mdi-navigation-close right"></i></span>
                            <p>A manga term denoting sexual content that is added into the story mainly for fans of the genre. Although borderline at times, ecchi manga does not usually involve nudity.</p>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-image">
                            <img src="/images/mature.jpg"></img>
                        </div>
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4 center-align">Mature</span>
                        </div>
                        <div class="card-reveal">
                            <span class="card-title grey-text text-darken-4">Mature <i class="mdi-navigation-close right"></i></span>
                            <p>Manga which features nudity and places characters in sexual situations. Themes are targeted towards adults and must be 18 years or older to view.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="hide-on-large-only">
            <h5>How many chapters would you like to read?</h5>
            <div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-content">
                            <div class="valign-wrapper">
                                <div class="valign">
                                    <span class="grey-text text-darken-4">0 - 15</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-content">
                            <div class="valign-wrapper">
                                <div class="valign">
                                    <span class="grey-text text-darken-4">15 - 30</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-content">
                            <div class="valign-wrapper">
                                <div class="valign">
                                    <span class="grey-text text-darken-4">30 - 60</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-content">
                            <div class="valign-wrapper">
                                <div class="valign">
                                    <span class="grey-text text-darken-4">60 - 120</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-content">
                            <div class="valign-wrapper">
                                <div class="valign">
                                    <span class="grey-text text-darken-4">120 - 240</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col s12 l4">
                    <div class="card">
                        <div class="card-content">
                            <div class="valign-wrapper">
                                <div class="valign">
                                    <span class="grey-text text-darken-4">240 - UP</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section>
            <div id="results" class="row" style="overflow-y: scroll">
                
            </div>
        </section>
    </div>
</div>

<script type="text/javascript">
    var Browse = function(genres, mangaStatus, chapterMin, chapterMax)
    {
        this.genres = [];
        this.mangaStatus = [];
        this.chapterMin = Number.MAX_VALUE;
        this.chapterMax = Number.MIN_VALUE;
    };
    
    Browse.prototype = {
        hide: function(list, style)
        {
            var browseObject = this;
            console.log(this.genres);
            $('#' + list).children().each(function(){
                if(browseObject.genres.length !== 0 && !isEqual( $(this).data('genres').split(" "), browseObject.genres ))
                {
                    $(this).css('display','none');
                    return;
                }

                if(browseObject.mangaStatus.length !== 0 && !isEqual( $(this).data('status').split(" "), browseObject.mangaStatus ))
                {
                    $(this).css('display','none');
                    return;
                }

                var numOfChapters = parseInt($(this).data('numOfChapters'));
                if((browseObject.chapterMin !== Number.MAX_VALUE && browseObject.chapterMax !== Number.MIN_VALUE) && (numOfChapters <= browseObject.chapterMin || numOfChapters >= browseObject.chapterMax))
                {
                    $(this).css('display','none');
                    return;
                }
                console.log('\trange passed:\t' + $(this).data('numOfChapters'));
                
                $(this).css('display','block');
            });
        },
        
        show: function(list)
        {
            this.hide(list, 'block');
        }
    }
    
    function isEqual(a,b)
    {
        for(var i = 0; i < b.length; i++)
        {
            if(a.indexOf(b[i]) < 0)
            {
                return false;
            }
        }
        return true;
    }
    
    var browse;

    $.get('/api/v1/manga/search', function(data){
        for(var i = 0; i < data.length; i++)
        {
            $('#results').append(
                '<div data-status="'+ data[i].status +'" data-genres="'+ data[i].genres.join(" ") +'" data-title="'+ data[i].title.replace(' ','_') +'" data-num-of-chapters="'+ data[i].numOfChapters +'" class="col s12 m4 l3">' + 
                    '<a href="/manga/'+ data[i].title.replace(' ','_') +'"><img height="190" width="250" class="responsive-img" src="'+ data[i].coverUrl +'"></img><span class="center-align">'+ data[i].title +'</span><br><span class="center-align">'+ data[i].genres.toString() +'</span><br><span class="center-align">'+ data[i].numOfChapters +'</span><br><span class="center-align">'+ data[i].status +'</span></a>' +
                '</div>'
            );
        }
        browse = new Browse();
    });
    
    $('#filter li').click(function(){
        $(this).toggleClass('red-text lighten-1');
    });
    
    $('#filter-genres li').click(function(){
        var selectedGenre = $(this);
        if(selectedGenre.hasClass('red-text'))
        {
            if(browse.genres.indexOf(selectedGenre.attr('value')) === -1)
            {
                browse.genres.push(selectedGenre.attr('value'));
            }
        }
        else
        {
            var value = selectedGenre.attr('value');
            browse.genres = browse.genres.filter(function(elem){
                return elem !== value;
            });
        }
        browse.hide('results');
    });
    
    $('#filter-status li').click(function(){
        if($(this).hasClass('red-text'))
        {
            if(browse.mangaStatus.indexOf($(this).attr('value')) === -1)
            {
                browse.mangaStatus.push($(this).attr('value'));
            }
        }
        else
        {
            var value = $(this).attr('value');
            browse.mangaStatus = browse.mangaStatus.filter(function(elem){
                return elem !== value;
            });
        }
        browse.hide('results');
    });
    
    $('#filter-chapters li').click(function(){
        browse.chapterMin = Number.MAX_VALUE;
        browse.chapterMax = Number.MIN_VALUE;
        $('#filter-chapters .red-text').each(function(){
            var minMax = $(this).attr('value').split(" ");
            if(browse.chapterMin > parseInt(minMax[0]))
            {
                browse.chapterMin = minMax[0];
            }
            if(isNaN(parseInt(minMax[1])) || (browse.chapterMax < parseInt(minMax[1])))
            {
                browse.chapterMax = parseInt(minMax[1]) || Number.POSITIVE_INFINITY;
            }
        });
        browse.hide('results');
    });
</script>